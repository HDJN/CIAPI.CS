<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="src/tools/fauxconsole.js" type="text/javascript"></script>
    <style type="text/css">
        @import 'src/tools/fauxconsole.css';
    </style>
    
    
    
    <script type="text/javascript">
        console.addLoadEvent(function () {


            var schema = exports.schema;
            var smd = exports.smd;
            var schemaPatch = exports.schema;
            var routesPatch = exports.routesPatch;

            var JSchemaProvider = exports.JSchemaProvider;
            var CSharpVisitor = exports.CSharpVisitor;
            var CSharpRouteGenerator = exports.CSharpRouteGenerator;

            var LSChannelGenerator = exports.LSChannelGenerator;



            var visitor = new CSharpVisitor();
            var provider = new JSchemaProvider(visitor);
            // FIXME: schema should be a ctor param 
            provider.schema = schema;
            // FIXME: instigator should not take parameters
            provider.visit("root", schema, "schema");
            var output = visitor.toString();
            // IE sucks
            //output = output.replace(/\n/g, "<br/>\n").replace(/\s/g, "&nbsp;");
            document.getElementById("code").value = output;

            var rpcGenerator = new CSharpRouteGenerator(smd.services.rpc, schema, "CIAPI.Rpc", "Client", ["System", "System.Collections.Generic", "CityIndex.JsonClient", "CIAPI.DTO"], routesPatch);
            var rpcRoutes = rpcGenerator.generate();
            document.getElementById("routes").value = rpcRoutes;

            var channelGenerator = new LSChannelGenerator();
            var channels = channelGenerator.generateChannels(smd.services.streaming);
            document.getElementById("channels").value = channels;
        });

        var exports = {};
    </script>
    <script src="src/meta/schema.js" type="text/javascript"></script>
    <script src="src/meta/smd.js" type="text/javascript"></script>
    <script src="src/meta/schema.patch.js" type="text/javascript"></script>
    <script src="src/meta/routes.patch.js" type="text/javascript"></script>
    <script src="src/JSchemaProvider.js" type="text/javascript"></script>
    <script src="src/JSchemaProvider.CSharpVisitor.js" type="text/javascript"></script>
    <script src="src/CSharpRouteGenerator.js" type="text/javascript"></script>
    <script src="src/CSharpLightStreamerChannelGenerator.js" type="text/javascript"></script>
</head>
<body>
    <textarea id="code" style="width: 100%; height: 400px"></textarea>
    <textarea id="routes" style="width: 100%; height: 400px"></textarea>
    <textarea id="channels" style="width: 100%; height: 400px"></textarea>
    
</body>
</html>
